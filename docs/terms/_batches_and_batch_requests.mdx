### Batches and Batch Requests: Design Motivation

Typically, a user need specify only the Batch Request. The Batch Request will describe what data Great
Expectations should fetch, including the name of the Data Asset and other identifiers (see more detail below).

A **Batch Definition** includes all the information required to precisely identify a set of data from the external data
source that should be translated into a Batch. One or more BatchDefinitions are always *returned* from the Datasource,
as a result of processing the Batch Request. A Batch Definition includes several key components:

* **Batch Identifiers**: contains information that uniquely identifies a specific batch from the Data Asset, such as the
  delivery date or query time.
* **Engine Passthrough**: contains information that will be passed directly to the Execution Engine as part of the Batch
  Spec.
* **Sample Definition**: contains information about sampling or limiting done on the Data Asset to create a Batch.

:::info Best practice
We recommend that you make every Data Asset Name **unique** in your Data Context configuration. Even though a Batch
Definition includes the Data Connector Name and Execution Environment Name, choosing a unique Data Asset name makes it
easier to navigate quickly through Data Docs and ensures your logical data assets are not confused with any particular
view of them provided by an Execution Engine.
:::

A **Batch Spec** is an Execution Engine-specific description of the Batch. The Data Connector is responsible for working
with the Execution Engine to translate the Batch Definition into a spec that enables Great Expectations to access the
data using that Execution Engine.

Finally, the **BatchMarkers** are additional pieces of metadata that can be useful to understand reproducibility, such
as the time the batch was constructed, or hash of an in-memory DataFrame.

### Batches and Batch Requests: A full journey

Let's follow the outline in this diagram to follow the journey from `BatchRequest` to `BatchDefinition` to `BatchSpec`
to `Batch`:

![Image](https://lucid.app/publicSegments/view/429a4083-ad56-477c-907a-671df36e3346/image.png)

1. `BatchRequest`

* The `BatchRequest` is the object a user passes to the `DataSource` to request a `Batch` (or `Batches`).
    * It can include `data_connector_query` params with values relative to the latest batch (e.g. the "latest" slice).
      Conceptually, this enables "fetch the latest `Batch`" behavior. It is the key thing that differentiates
      a `BatchRequest`, which does NOT necessarily uniquely identify the `Batch(es)` to be fetched, from a
      BatchDefinition.
    * The BatchRequest can also include a section called `batch_spec_passthrough` to make it easy to directly
      communicate parameters to a specific ExecutionEngine.
    * When resolved, the `BatchRequest` may point to many `BatchDefinitions` and Batches.

* A BatchRequest is the entrypoint to getting a `Batch` from a Datasource, using
  the `get_batch_list_from_batch_request()` method:

```python
DataSource.get_batch_list_from_batch_request(batch_request={
    "datasource": "myds",
    "data_connector": "pipeline",
    "in_memory_dataset": df,
    "data_connector_query" : {
      "batch_filter_parameters" : {
          "airflow_run_id": my_run_id,
          "other_key": my_other_key
      }
      "custom_filter_function": my_filter_fn,
      "limit": 10,
      "index": Optional[Union[int, list, tuple, slice, str]],  # examples: 0; "-1"; [3:7]; "[2:4]"
    },
    "sampling": {
        "limit": 1000,
        "sample": 0.1
    }
})
```
2. `BatchDefinition`

* A `BatchDefinition` resolves any ambiguity in `BatchRequest` to uniquely identify a single `Batch` to be
  fetched.  `BatchDefinition` is Datasource- and ExecutionEngine-agnostic. That means that its parameters may depend on
  the configuration of the `Datasource`, but they do not otherwise depend on the specific `DataConnector` type (e.g.
  filesystem, SQL, etc.) or `ExecutionEngine` being used to instantiate `Batches`.

```yaml
BatchDefinition
    datasource: str
    data_connector: str
    data_asset_name: str
    batch_identifiers:
        ** contents depend on the configuration of the DataConnector **
        ** provides a persistent, unique identifier for the Batch within the context of the Data Asset **
```

3. `BatchSpec`

* A `BatchSpec` is a set of specific instructions for the `ExecutionEngine` to fetch specific data; it is the
  ExecutionEngine-specific version of the BatchDefinition. For example, a `BatchSpec` could include the path to files,
  information about headers, or other configuration required to ensure the data is loaded properly for validation.

4. During initialization of the Batch, `BatchMarkers`, calculated by the `ExecutionEngine`, are also added. They are
   metadata that can be used to calculate performance characteristics, ensure reproducibility of Validation Results, and
   provide indicators of the state of the underlying data system.